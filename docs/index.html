<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Offline Chess Coach</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  background: #0f172a;
  color: #e5e7eb;
  font-family: system-ui, sans-serif;
}

#board-wrapper {
  max-width: 360px;
  margin: 16px auto;
  padding-top: 100%;
  position: relative;
}

#board {
  position: absolute;
  inset: 0;
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  border: 3px solid #334155;
}

.square {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.2rem;
}

.light { background: #f0d9b5; }
.dark  { background: #b58863; }

.white { color: #fff; text-shadow: 0 0 3px #000; }
.black { color: #111; text-shadow: 0 0 3px #fff; }

#coach {
  padding: 12px;
  background: #020617;
  min-height: 60px;
}

#controls {
  padding: 12px;
}

button {
  width: 100%;
  padding: 12px;
  background: #1e293b;
  color: #e5e7eb;
  border: none;
  border-radius: 8px;
}
</style>
</head>

<body>

<div id="board-wrapper">
  <div id="board"></div>
</div>

<div id="coach"><strong>Coach:</strong> Play mode.</div>

<div id="controls">
  <button onclick="startTactics()">⚔️ Start Tactics (10 puzzles)</button>
</div>

<script src="https://unpkg.com/chess.js@1.0.0/chess.min.js"></script>

<script>
const boardEl = document.getElementById("board");
const coachEl = document.getElementById("coach");

let game = new Chess();
let selected = null;
let mode = "play";
let puzzleIndex = 0;

/* ===== TACTICS DATABASE ===== */

const puzzles = [
{
  fen: "4k3/3q4/8/8/8/8/4K2R/8 w - - 0 1",
  solution: ["h2h8"],
  difficulty: "easy",
  theme: "mate",
  explanation: {
    idea: "Back-rank mate.",
    principle: "The king has no escape squares."
  }
},
{
  fen: "6k1/3q4/8/8/8/5N2/8/6K1 w - - 0 1",
  solution: ["f3e5"],
  difficulty: "medium",
  theme: "fork",
  explanation: {
    idea: "Knight fork.",
    principle: "One piece attacks two valuable targets."
  }
}
];

/* ===== DRAW BOARD ===== */

function drawBoard() {
  boardEl.innerHTML = "";
  const board = game.board();

  for (let r = 7; r >= 0; r--) {
    for (let c = 0; c < 8; c++) {
      const sq = "abcdefgh"[c] + (r+1);
      const div = document.createElement("div");
      div.className = "square " + ((r + c) % 2 ? "dark" : "light");

      const piece = game.get(sq);
      if (piece) {
        const span = document.createElement("span");
        span.textContent = pieceUnicode(piece);
        span.className = piece.color === "w" ? "white" : "black";
        div.appendChild(span);
      }

      div.onclick = () => tapSquare(sq);
      boardEl.appendChild(div);
    }
  }
}

function pieceUnicode(p) {
  const map = {
    wp:"♙", wr:"♖", wn:"♘", wb:"♗", wq:"♕", wk:"♔",
    bp:"♟", br:"♜", bn:"♞", bb:"♝", bq:"♛", bk:"♚"
  };
  return map[p.color + p.type];
}

/* ===== INPUT HANDLING ===== */

function tapSquare(square) {
  if (!selected) {
    selected = square;
    return;
  }

  const move = game.move({
    from: selected,
    to: square,
    promotion: "q"
  });

  selected = null;

  if (!move) return;

  drawBoard();
  handleMove(move.san);
}

function handleMove() {
  if (mode !== "tactics") return;

  const puzzle = puzzles[puzzleIndex];
  const playedMoves = game.history({ verbose: false });

  if (playedMoves.join(" ") === puzzle.solution.join(" ")) {
    coachEl.innerHTML =
      `<strong>Coach:</strong> Correct. ${puzzle.explanation.idea} ${puzzle.explanation.principle}`;
    setTimeout(nextPuzzle, 1500);
  }
}

/* ===== TACTICS FLOW ===== */

function startTactics() {
  mode = "tactics";
  puzzleIndex = 0;
  loadPuzzle();
}

function loadPuzzle() {
  game = new Chess(puzzles[puzzleIndex].fen);
  coachEl.innerHTML =
    `<strong>Coach:</strong> Puzzle ${puzzleIndex+1} of 10. Your move.`;
  drawBoard();
}

function nextPuzzle() {
  puzzleIndex++;
  if (puzzleIndex >= puzzles.length) {
    coachEl.innerHTML =
      "<strong>Coach:</strong> Training complete. Well done.";
    return;
  }
  loadPuzzle();
}

drawBoard();
</script>

</body>
  </html>
