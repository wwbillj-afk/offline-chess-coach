<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Offline Chess Coach</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      margin: 0;
      background: #0f172a;
      color: #e5e7eb;
      font-family: system-ui, sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    #board {
      width: 90vw;
      max-width: 360px;
      aspect-ratio: 1 / 1;
      margin: 16px auto;
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      border: 2px solid #334155;
    }

    .square {
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
    }

    .light { background: #cbd5e1; }
    .dark  { background: #475569; }

    .selected {
      outline: 4px solid #22c55e;
      outline-offset: -4px;
    }

    img {
      width: 90%;
      height: 90%;
      pointer-events: none;
    }

    #coach {
      flex: 1;
      padding: 12px;
      background: #020617;
      border-top: 1px solid #1e293b;
      overflow-y: auto;
    }

    #controls {
      display: flex;
      gap: 8px;
      padding: 12px;
      background: #020617;
      border-top: 1px solid #1e293b;
    }

    button {
      flex: 1;
      padding: 12px;
      background: #1e293b;
      color: #e5e7eb;
      border: none;
      border-radius: 8px;
      font-size: 0.9rem;
    }
  </style>
</head>

<body>

  <div id="board"></div>

  <div id="coach">
    <p><strong>Coach:</strong> Tap one of your pieces, then tap a destination square.</p>
  </div>

  <div id="controls">
    <button disabled>üéô Push to Talk</button>
    <button disabled>‚ùì Why?</button>
  </div>

  <script src="https://unpkg.com/chess.js@1.0.0/chess.min.js"></script>

  <script>
    const game = new Chess();
    const boardEl = document.getElementById("board");
    let selectedSquare = null;

    function renderBoard() {
      boardEl.innerHTML = "";
      const board = game.board();

      for (let row = 7; row >= 0; row--) {
        for (let col = 0; col < 8; col++) {
          const squareEl = document.createElement("div");
          const isLight = (row + col) % 2 === 0;
          squareEl.className = "square " + (isLight ? "light" : "dark");

          const square = "abcdefgh"[col] + (row + 1);
          squareEl.dataset.square = square;

          const piece = board[row][col];
          if (piece) {
            squareEl.innerHTML = pieceImg(piece);
          }

          if (square === selectedSquare) {
            squareEl.classList.add("selected");
          }

          squareEl.onclick = () => onSquareTap(square);
          boardEl.appendChild(squareEl);
        }
      }
    }

    function onSquareTap(square) {
      const piece = game.get(square);

      if (!selectedSquare) {
        if (!piece || piece.color !== game.turn()) {
          addCoach("Select one of your own pieces.");
          return;
        }
        selectedSquare = square;
        renderBoard();
        return;
      }

      const move = game.move({
        from: selectedSquare,
        to: square,
        promotion: "q"
      });

      selectedSquare = null;

      if (move) {
        addCoach("Move played: <strong>" + move.san + "</strong>");
      } else {
        addCoach("That move is not legal.");
      }

      renderBoard();
    }

    function pieceImg(piece) {
      const color = piece.color === "w" ? "w" : "b";
      const type = piece.type.toUpperCase();
      return `<img src="https://raw.githubusercontent.com/lichess-org/lila/master/public/piece/cburnett/${color}${type}.svg">`;
    }

    function addCoach(text) {
      const coach = document.getElementById("coach");
      const p = document.createElement("p");
      p.innerHTML = "<strong>Coach:</strong> " + text;
      coach.appendChild(p);
      coach.scrollTop = coach.scrollHeight;
    }

    renderBoard();
  </script>

</body>
  </html>
