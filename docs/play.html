<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Play vs Coach — Reliable Fallback</title>
<style>
  :root{
    --bg-top:#0b1d33; --bg-bottom:#07102a;
    --light:#dceefc; --dark:#274252;
    --accent:#6bb12b;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg-top),var(--bg-bottom));font-family:system-ui,Arial;color:#eef6ff}
  header{padding:16px;text-align:center;font-weight:700;font-size:20px}
  #app{display:flex;gap:12px;height:calc(100vh - 56px);padding:8px;box-sizing:border-box}
  #left{flex:1;display:flex;flex-direction:column;align-items:center}
  /* simple board container */
  #boardWrap{background:rgba(255,255,255,0.02);padding:12px;border-radius:12px;box-shadow:0 12px 30px rgba(0,0,0,0.6)}
  /* grid board: square by vw with min size */
  #board {
    width:92vw; max-width:460px; min-width:300px;
    display:grid; grid-template-columns:repeat(8,1fr);
    aspect-ratio:1/1; border-radius:10px; overflow:hidden;
  }
  .sq { display:flex; align-items:center; justify-content:center; user-select:none; touch-action:manipulation; font-size:calc(18px + 2.6vw); }
  .light { background: linear-gradient(180deg,var(--light),#cce7f5); color:#07101a; }
  .dark { background: linear-gradient(180deg,var(--dark),#35556b); color:#f7fbff; }
  .selected { outline:4px solid rgba(107,177,43,0.5); box-shadow:0 8px 18px rgba(0,0,0,0.4); }
  /* controls */
  .controls{display:flex;gap:12px;align-items:center;margin-top:12px;width:100%;max-width:680px}
  .btn{padding:10px 14px;border-radius:12px;border:none;background:#1f2937;color:#eef6ff;cursor:pointer}
  .btn.primary{background:var(--accent);color:#05220b;font-weight:700}
  #statusSmall{font-weight:600;color:#dbe8f3}
  /* coach */
  #coach{width:320px;background:rgba(2,6,23,0.6);border-left:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;padding:12px;box-sizing:border-box}
  #coachHeader{display:flex;gap:12px;align-items:center;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,0.03)}
  #avatar{width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,#f472b6,#fb7185);display:flex;align-items:center;justify-content:center;color:#07102a;font-weight:700}
  #coachBody{flex:1;overflow:auto;padding-top:8px}
  .coachLine{margin-bottom:10px;font-size:14px}
  #coachFooter{display:flex;gap:8px;padding-top:8px;border-top:1px solid rgba(255,255,255,0.03)}
  @media(max-width:900px){#coach{display:none}}
</style>
</head>
<body>

<header>Play vs Coach</header>

<div id="app">
  <div id="left">
    <div id="boardWrap">
      <div id="board" aria-label="Chessboard"></div>
    </div>

    <div class="controls">
      <button class="btn" id="resetBtn">Reset</button>
      <button class="btn primary" id="flipBtn">Flip Board</button>
      <div style="flex:1"></div>
      <div id="statusSmall">Coach: Ready</div>
    </div>
  </div>

  <div id="coach">
    <div id="coachHeader">
      <div id="avatar">♛</div>
      <div>
        <div style="font-weight:700" id="coachName">Coach</div>
        <div style="font-size:13px;color:#cbd5e1">Friendly teacher</div>
      </div>
    </div>

    <div id="coachBody"></div>

    <div id="coachFooter">
      <button class="btn" id="whyBtn">Why?</button>
      <button class="btn" id="hideCoachBtn">Hide</button>
    </div>
  </div>
</div>

<script>
/* Guaranteed simple board using Unicode pieces (no external resources) */

/* Unicode pieces map */
const PIECES = {
  r:'♜', n:'♞', b:'♝', q:'♛', k:'♚', p:'♟',
  R:'♖', N:'♘', B:'♗', Q:'♕', K:'♔', P:'♙'
};

/* starting position array (0=a8 ... 63=h1) */
let pos = [
  'r','n','b','q','k','b','n','r',
  'p','p','p','p','p','p','p','p',
  '','','','','','','','',
  '','','','','','','','',
  '','','','','','','','',
  '','','','','','','','',
  'P','P','P','P','P','P','P','P',
  'R','N','B','Q','K','B','N','R'
];

let flipped = false;
let selected = null;

/* DOM refs */
const boardEl = document.getElementById('board');
const coachBody = document.getElementById('coachBody');
const statusSmall = document.getElementById('statusSmall');

/* coach */
function coachSay(text){
  const d = document.createElement('div');
  d.className = 'coachLine';
  d.innerHTML = `<strong>Coach:</strong> ${text}`;
  coachBody.appendChild(d);
  coachBody.scrollTop = coachBody.scrollHeight;
  statusSmall.textContent = 'Coach: ' + text;
}

/* draw board */
function drawBoard(){
  boardEl.innerHTML = '';
  const indices = [...Array(64).keys()];
  if(flipped) indices.reverse();
  for(const idx of indices){
    const r = Math.floor(idx/8), c = idx%8;
    const div = document.createElement('div');
    div.className = 'square ' + (((r+c)%2) ? 'dark' : 'light');
    div.dataset.idx = idx;
    const piece = pos[idx];
    if(piece){
      const span = document.createElement('div');
      span.textContent = PIECES[piece] || '?';
      span.style.fontSize = 'calc(18px + 2.6vw)';
      span.style.filter = 'drop-shadow(0 6px 10px rgba(0,0,0,0.35))';
      div.appendChild(span);
    }
    if(selected === idx) div.classList.add('selected');
    div.addEventListener('click', ()=>onSquareClick(Number(div.dataset.idx)));
    boardEl.appendChild(div);
  }
}

/* click handling */
function onSquareClick(idx){
  if(selected === null){
    if(!pos[idx]){ coachSay('Tap a piece first.'); return; }
    selected = idx; drawBoard(); coachSay('Selected ' + idxToAlg(idx)); return;
  }
  if(selected === idx){ selected = null; drawBoard(); coachSay('Selection cleared.'); return; }
  pos[idx] = pos[selected]; pos[selected] = ''; selected = null; drawBoard(); coachSay(`${playerName} moved to ${idxToAlg(idx)}.`);
}

/* helper */
function idxToAlg(i){ return String.fromCharCode(97 + (i%8)) + (8 - Math.floor(i/8)); }

/* controls */
document.getElementById('flipBtn').addEventListener('click', ()=>{ flipped = !flipped; drawBoard(); });
document.getElementById('resetBtn').addEventListener('click', ()=>{ pos = [
  'r','n','b','q','k','b','n','r',
  'p','p','p','p','p','p','p','p',
  '','','','','','','','',
  '','','','','','','','',
  '','','','','','','','',
  '','','','','','','','',
  'P','P','P','P','P','P','P','P',
  'R','N','B','Q','K','B','N','R'
]; selected = null; flipped = false; coachBody.innerHTML=''; coachSay('Board reset.'); drawBoard(); });

document.getElementById('whyBtn').addEventListener('click', ()=>coachSay('Because chess is about ideas — think what your pieces control.'));
document.getElementById('hideCoachBtn').addEventListener('click', ()=>{ const p=document.getElementById('coach'); p.style.display = p.style.display==='none' ? 'flex' : 'none'; });

/* name memory */
let playerName = localStorage.getItem('playerName') || null;
if(!playerName){ playerName = prompt('What shall I call you?'); if(!playerName) playerName = 'Friend'; localStorage.setItem('playerName', playerName); }
coachSay(`Hello ${playerName}. We learn from books and practice deliberately.`);

/* initial draw */
drawBoard();
</script>
</body>
  </html>
