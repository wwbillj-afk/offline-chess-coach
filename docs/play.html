<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Offline Chess Coach</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css"/>

<style>
  :root{--bg:#071827;--panel:rgba(255,255,255,0.03);--accent:#3ddc84}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#020617);font-family:system-ui;color:#eaf6ff}
  .wrap{max-width:520px;margin:0 auto;padding:18px 14px}
  h1{text-align:center;margin:8px 0 16px;font-weight:800}
  .coach-card{display:flex;gap:12px;align-items:center;background:var(--panel);padding:12px;border-radius:12px}
  .coach-card img{width:64px;height:64px;border-radius:50%;object-fit:cover;border:3px solid var(--accent)}
  .coach-text{font-size:14px}
  .label{margin-top:16px;font-size:14px}
  input[type=range]{width:100%;margin-top:8px}
  .start-btn{margin-top:14px;width:100%;padding:14px;border-radius:999px;border:none;background:var(--accent);color:#04220f;font-weight:700;font-size:16px}
  #boardWrap{display:none;margin-top:18px;max-width:420px}
  #board{width:100%;height:380px;border-radius:12px;box-shadow:0 20px 40px rgba(0,0,0,.6)}
  @media(min-width:900px){ #board{height:520px} }
  .status{margin-top:10px;color:#9fb1c7}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Offline Chess Coach</h1>

    <div class="coach-card" aria-live="polite">
      <!-- EXACT filename from your repo -->
      <img src="file_00000000d88871fdb6de52fee7800f79.png" alt="Coach">
      <div class="coach-text">
        <strong>Coach</strong><br>
        Welcome. Pick a level and press <strong>Start game</strong>.
      </div>
    </div>

    <div class="label">Difficulty â€” <span id="levelLabel">5</span></div>
    <input id="level" type="range" min="1" max="10" value="5">

    <button id="start" class="start-btn">Start game</button>

    <div id="boardWrap">
      <div id="board"></div>
      <div class="status" id="status">Coach: Ready.</div>
    </div>
  </div>

  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/chess.js@1.0.0/chess.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>

  <script>
  (function(){
    const startBtn = document.getElementById('start');
    const boardWrap = document.getElementById('boardWrap');
    const statusEl = document.getElementById('status');
    const level = document.getElementById('level');
    const levelLabel = document.getElementById('levelLabel');

    level.addEventListener('input', ()=>{ levelLabel.textContent = level.value; });

    let game = null;
    let board = null;

    function initBoard(){
      // initialize chess.js game
      game = new Chess();

      // init chessboardjs
      board = Chessboard('board', {
        draggable: true,
        position: 'start',
        pieceTheme: 'https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/dist/img/chesspieces/wikipedia/{piece}.png',
        onDragStart: function(source, piece, position, orientation) {
          // don't allow moves if game over
          if (game.game_over()) return false;
          // allow only white to be moved by player for now
          if (piece && piece.startsWith('b')) return false;
        },
        onDrop: function(source, target) {
          const move = game.move({ from: source, to: target, promotion: 'q' });
          if (move === null) return 'snapback';
          // update board position
          board.position(game.fen());
          statusEl.textContent = 'Coach: Thinking...';
          // simple reply from coach after short delay
          setTimeout(coachReply, 300);
        },
        onSnapEnd: function() {
          board.position(game.fen());
        }
      });
      // ensure board visible and resized on mobile
      setTimeout(()=>{ try{ board.resize(); } catch(e){} }, 120);
    }

    function coachReply(){
      if (!game) return;
      if (game.game_over()){
        statusEl.textContent = 'Coach: Game over.';
        return;
      }
      const moves = game.moves();
      if (!moves || moves.length === 0){
        statusEl.textContent = 'Coach: No legal moves.';
        return;
      }
      // pick a random legal move as placeholder
      const chosen = moves[Math.floor(Math.random() * moves.length)];
      game.move(chosen);
      board.position(game.fen());
      statusEl.textContent = 'Coach: Your move.';
    }

    startBtn.addEventListener('click', ()=>{
      // show board area and create board/game if not already
      boardWrap.style.display = 'block';
      if (!board) {
        try {
          initBoard();
        } catch (e) {
          statusEl.textContent = 'Error initializing board: ' + e;
          return;
        }
      } else {
        game.reset();
        board.position('start');
      }
      statusEl.textContent = 'Coach: Game started. Your move.';
      // scroll to board for mobile
      setTimeout(()=>{ window.scrollTo({ top: document.getElementById('board').offsetTop - 20, behavior: 'smooth' }); }, 100);
    });

  })();
  </script>
</body>
      </html>
