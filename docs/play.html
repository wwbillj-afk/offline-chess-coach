<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Play vs Coach</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css"/>

<style>
body {
  margin: 0;
  background: radial-gradient(circle at top, #0b1d33, #020617);
  font-family: system-ui, sans-serif;
  color: #e5e7eb;
}

header {
  padding: 16px;
  text-align: center;
  font-size: 22px;
  font-weight: 700;
}

#board-wrap {
  max-width: 420px;
  margin: 0 auto;
  padding: 12px;
}

#board {
  width: 100%;
  border-radius: 16px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.6);
}

#controls {
  display: flex;
  gap: 10px;
  margin-top: 12px;
}

button {
  flex: 1;
  padding: 12px;
  border-radius: 999px;
  border: none;
  background: #1e293b;
  color: #e5e7eb;
  font-weight: 600;
}

button.primary {
  background: #84cc16;
  color: #020617;
}

#coach {
  max-width: 420px;
  margin: 12px auto;
  padding: 14px;
  background: #020617;
  border-radius: 14px;
  font-size: 14px;
}

#difficulty {
  margin-top: 10px;
}

input[type=range] {
  width: 100%;
}

.small {
  opacity: 0.8;
}
</style>
</head>

<body>

<header>Play vs Coach</header>

<div id="board-wrap">
  <div id="board"></div>

  <div id="controls">
    <button onclick="resetGame()">Reset</button>
    <button class="primary" onclick="flipBoard()">Flip Board</button>
  </div>

  <div id="difficulty">
    <div><strong>Difficulty:</strong> <span id="levelLabel"></span></div>
    <input type="range" min="1" max="10" value="5" oninput="updateLevel(this.value)">
  </div>
</div>

<div id="coach">
  <strong>Coach:</strong>
  <div id="coachText">Welcome. I will play seriously â€” but explain gently.</div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chess.js@0.13.4/chess.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>

<script>
const game = new Chess();
let board;
let engine;
let skill = 5;

const levelNames = {
  1: "Beginner",
  3: "Casual",
  5: "Intermediate",
  7: "Advanced",
  10: "Master"
};

function updateLevel(v) {
  skill = Number(v);
  document.getElementById("levelLabel").textContent =
    v + " â€” " + (levelNames[v] || "Custom");
}
updateLevel(5);

function coachSay(t) {
  document.getElementById("coachText").textContent = t;
}

/* ðŸ”¥ STOCKFISH â€” NO DOWNLOAD, NO FILES */
function startEngine() {
  engine = new Worker(URL.createObjectURL(new Blob([`
    self.importScripts('https://unpkg.com/stockfish/stockfish.js');
    onmessage = e => {
      if (typeof e.data === 'string') postMessage(e.data);
    };
  `], { type: 'application/javascript' })));

  engine.onmessage = e => {
    const line = e.data;
    if (line.startsWith("bestmove")) {
      const move = line.split(" ")[1];
      game.move({
        from: move.slice(0,2),
        to: move.slice(2,4),
        promotion: "q"
      });
      board.position(game.fen());
      coachSay("Your turn. Think about your plan.");
    }
  };

  engine.postMessage("uci");
  engine.postMessage("setoption name Skill Level value " + skill);
}

function engineMove() {
  engine.postMessage("position fen " +
