<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Play ‚Äì Offline Chess Coach</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  background: #0f172a;
  color: #e5e7eb;
  font-family: system-ui, sans-serif;
  padding-bottom: 70px;
}

.hidden { display: none; }

h2 {
  margin: 16px;
  font-size: 1.2rem;
}

.section {
  padding: 16px;
  border-bottom: 1px solid #1e293b;
}

label {
  display: block;
  margin-bottom: 6px;
  font-size: 0.9rem;
  color: #cbd5f5;
}

input[type="range"] {
  width: 100%;
}

select, button, input[type="text"] {
  width: 100%;
  padding: 12px;
  margin-top: 8px;
  background: #1e293b;
  color: #e5e7eb;
  border: none;
  border-radius: 8px;
  font-size: 1rem;
}

button.primary {
  background: #7cb342;
  color: #000;
  font-weight: bold;
}

#board {
  width: 90vw;
  max-width: 360px;
  aspect-ratio: 1 / 1;
  margin: 16px auto;
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  border: 3px solid #334155;
}

.square {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.2rem;
  user-select: none;
}

.light { background: #f0d9b5; }
.dark  { background: #b58863; }

.white { color: #fff; text-shadow: 0 0 3px #000; }
.black { color: #111; text-shadow: 0 0 3px #fff; }

#coach-toggle {
  position: fixed;
  bottom: 70px;
  right: 16px;
  background: #1e293b;
  padding: 10px 14px;
  border-radius: 20px;
  font-size: 0.85rem;
}

#coach-panel {
  position: fixed;
  bottom: 70px;
  left: 0;
  right: 0;
  background: #020617;
  padding: 16px;
  max-height: 40%;
  overflow-y: auto;
  border-top: 1px solid #1e293b;
}

.nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 64px;
  background: #020617;
  display: flex;
  border-top: 1px solid #1e293b;
}

.nav a {
  flex: 1;
  text-align: center;
  padding-top: 6px;
  font-size: 0.75rem;
  color: #cbd5f5;
  text-decoration: none;
}

.nav span {
  display: block;
  font-size: 1.4rem;
}
</style>
</head>

<body>

<!-- SETUP SCREEN -->
<div id="setup">

  <h2>New Game</h2>

  <div class="section">
    <label>Your name (coach will use it)</label>
    <input type="text" id="playerName" placeholder="Enter your name">
  </div>

  <div class="section">
    <label>Coach Strength</label>
    <input type="range" min="400" max="2400" value="800" id="strength">
    <div id="strengthLabel">Beginner (800)</div>
  </div>

  <div class="section">
    <label>Coach Assistance</label>
    <select id="assistance">
      <option value="on">Guidance ON</option>
      <option value="off">Silent (analysis only)</option>
    </select>
  </div>

  <div class="section">
    <label>Timer</label>
    <select id="timer">
      <option value="none">No Timer</option>
      <option value="180">3 Minutes</option>
      <option value="300">5 Minutes</option>
      <option value="600">10 Minutes</option>
      <option value="900">15 Minutes</option>
    </select>
  </div>

  <div class="section">
    <button class="primary" onclick="startGame()">Start Game</button>
  </div>
</div>

<!-- GAME SCREEN -->
<div id="game" class="hidden">
  <div id="board"></div>

  <div id="coach-toggle" onclick="toggleCoach()">‚Üë Coach</div>

  <div id="coach-panel" class="hidden">
    <strong>Coach:</strong>
    <div id="coach-text"></div>
  </div>
</div>

<!-- NAV -->
<div class="nav">
  <a href="index.html"><span>üè†</span>Home</a>
  <a href="play.html"><span>‚ñ∂Ô∏è</span>Play</a>
  <a href="puzzles.html"><span>üß©</span>Puzzles</a>
  <a href="training.html"><span>üéì</span>Learn</a>
  <a href="#"><span>üìà</span>Progress</a>
</div>

<script src="https://unpkg.com/chess.js@1.0.0/chess.min.js"></script>

<script>
const strength = document.getElementById("strength");
const strengthLabel = document.getElementById("strengthLabel");
const coachText = document.getElementById("coach-text");

strength.oninput = () => {
  const v = strength.value;
  let label = "Beginner";
  if (v >= 800) label = "Strong Beginner";
  if (v >= 1000) label = "Intermediate";
  if (v >= 1300) label = "Advanced";
  if (v >= 1600) label = "Expert";
  if (v >= 1900) label = "Master";
  strengthLabel.textContent = `${label} (${v})`;
};

let game, playerName;

function startGame() {
  playerName = document.getElementById("playerName").value || "Player";
  localStorage.setItem("playerName", playerName);

  document.getElementById("setup").classList.add("hidden");
  document.getElementById("game").classList.remove("hidden");

  game = new Chess();
  drawBoard();

  coachText.innerHTML =
    `Alright <strong>${playerName}</strong>. Let‚Äôs play thoughtfully. I‚Äôll be here if you need me.`;
}

function drawBoard() {
  const boardEl = document.getElementById("board");
  boardEl.innerHTML = "";
  const board = game.board();

  for (let r = 7; r >= 0; r--) {
    for (let c = 0; c < 8; c++) {
      const sq = "abcdefgh"[c] + (r + 1);
      const div = document.createElement("div");
      div.className = "square " + ((r + c) % 2 ? "dark" : "light");

      const piece = game.get(sq);
      if (piece) {
        div.textContent = pieceSymbol(piece);
        div.classList.add(piece.color === "w" ? "white" : "black");
      }

      div.onclick = () => tapSquare(sq);
      boardEl.appendChild(div);
    }
  }
}

let selected = null;

function tapSquare(sq) {
  if (!selected) {
    selected = sq;
    return;
  }

  const move = game.move({ from: selected, to: sq, promotion: "q" });
  selected = null;

  if (!move) return;
  drawBoard();
}

function pieceSymbol(p) {
  const map = {
    wp:"‚ôô", wr:"‚ôñ", wn:"‚ôò", wb:"‚ôó", wq:"‚ôï", wk:"‚ôî",
    bp:"‚ôü", br:"‚ôú", bn:"‚ôû", bb:"‚ôù", bq:"‚ôõ", bk:"‚ôö"
  };
  return map[p.color + p.type];
}

function toggleCoach() {
  document.getElementById("coach-panel").classList.toggle("hidden");
}
</script>

</body>
  </html>
