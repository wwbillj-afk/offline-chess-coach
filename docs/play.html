<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Play vs Coach</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">

<style>
body {
  margin: 0;
  background: radial-gradient(circle at top, #0b1d33, #020617);
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  color: #e5e7eb;
}

header {
  padding: 14px;
  text-align: center;
  font-size: 20px;
  font-weight: 600;
}

#container {
  display: flex;
  height: calc(100vh - 56px);
}

#board-area {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
}

#board {
  width: min(92vw, 480px);
  border-radius: 14px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.6);
}

#coach-panel {
  width: 320px;
  background: #020617;
  border-left: 1px solid #1e293b;
  display: flex;
  flex-direction: column;
}

#coach-header {
  padding: 12px;
  display: flex;
  align-items: center;
  gap: 10px;
  border-bottom: 1px solid #1e293b;
}

#coach-avatar {
  width: 38px;
  height: 38px;
  border-radius: 50%;
  background: linear-gradient(135deg, #f472b6, #fb7185);
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: bold;
  color: #020617;
}

#coach-body {
  flex: 1;
  padding: 12px;
  overflow-y: auto;
  font-size: 14px;
}

.coach-msg {
  margin-bottom: 10px;
}

#coach-footer {
  padding: 10px;
  border-top: 1px solid #1e293b;
  display: flex;
  gap: 8px;
}

button {
  flex: 1;
  padding: 10px;
  border-radius: 999px;
  border: none;
  background: #1e293b;
  color: #e5e7eb;
  cursor: pointer;
}

button:hover {
  background: #334155;
}

@media (max-width: 900px) {
  #coach-panel {
    display: none;
  }
}
</style>
</head>

<body>

<header>Play vs Coach</header>

<div id="container">
  <div id="board-area">
    <div id="board"></div>
  </div>

  <div id="coach-panel">
    <div id="coach-header">
      <div id="coach-avatar">♛</div>
      <strong>Coach</strong>
    </div>

    <div id="coach-body"></div>

    <div id="coach-footer">
      <button onclick="why()">Why?</button>
      <button onclick="toggleCoach()">Hide</button>
    </div>
  </div>
</div>

<!-- ✅ REQUIRED ORDER -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chess.js@0.13.4/chess.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>

<script>
let playerName = localStorage.getItem("playerName");
if (!playerName) {
  playerName = prompt("Hi! What’s your name?");
  if (!playerName) playerName = "Friend";
  localStorage.setItem("playerName", playerName);
}

const game = new Chess();

const board = Chessboard("board", {
  draggable: true,
  position: "start",
  pieceTheme: "https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/dist/img/chesspieces/wikipedia/{piece}.png",
  onDrop: onDrop
});

const coachBody = document.getElementById("coach-body");

function coachSay(text) {
  const div = document.createElement("div");
  div.className = "coach-msg";
  div.innerHTML = "<strong>Coach:</strong> " + text;
  coachBody.appendChild(div);
  coachBody.scrollTop = coachBody.scrollHeight;
}

coachSay(`Welcome, ${playerName}. Let’s play thoughtfully.`);

function onDrop(source, target) {
  const move = game.move({
    from: source,
    to: target,
    promotion: "q"
  });

  if (move === null) return "snapback";
  gentleFeedback(move);
}

function gentleFeedback(move) {
  if (move.flags.includes("c")) {
    coachSay("Nice capture. Think about what squares you control now.");
  } else if (game.in_check()) {
    coachSay("Check! Good awareness.");
  } else {
    coachSay("Interesting. What was your idea here?");
  }
}

function why() {
  coachSay("Because chess is about plans, not memorization.");
}

function toggleCoach() {
  const panel = document.getElementById("coach-panel");
  panel.style.display = panel.style.display === "none" ? "flex" : "none";
}
</script>

</body>
  </html>
