<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Play vs Coach — Debug Loader</title>

<style>
  body { margin:0; font-family:system-ui; background:#071226; color:#e6eef6; text-align:center; }
  header{ padding:18px; font-size:22px; font-weight:700; }
  #board { width:90vw; max-width:420px; margin:12px auto; border-radius:12px; box-shadow:0 12px 30px rgba(0,0,0,0.6); min-height:90vw; }
  #status { max-width:920px; margin:12px auto; padding:12px; background:rgba(255,255,255,0.03); border-radius:10px; text-align:left; font-family:monospace; white-space:pre-wrap; }
  .ok { color:#a7f3d0 }
  .err { color:#ffb4b4 }
  footer{height:40px}
</style>
</head>
<body>
  <header>Play vs Coach — Loader debug</header>

  <div id="board"></div>

  <div id="status">Starting loader...</div>

  <footer></footer>

<script>
/* Utility: append line to status */
function logLine(text, cls) {
  const st = document.getElementById('status');
  const p = document.createElement('div');
  p.textContent = text;
  if (cls) p.className = cls;
  st.appendChild(p);
  st.scrollTop = st.scrollHeight;
}

/* Global error handler shows visible error */
window.addEventListener('error', (e) => {
  logLine('GLOBAL ERROR: ' + (e && e.message ? e.message : String(e)), 'err');
});

/* Load a script by URL (promise) */
function loadScript(url) {
  return new Promise((resolve, reject) => {
    const s = document.createElement('script');
    s.src = url;
    s.onload = () => resolve(url);
    s.onerror = () => reject(url);
    document.head.appendChild(s);
  });
}

/* Try multiple candidate URLs in sequence until one loads */
async function tryCandidates(name, candidates) {
  for (const url of candidates) {
    try {
      logLine(`Trying ${name} from: ${url}`);
      await loadScript(url);
      logLine(`Loaded ${name} from: ${url}`, 'ok');
      return url;
    } catch (errUrl) {
      logLine(`Failed to load ${name} from: ${errUrl}`, 'err');
    }
  }
  throw new Error(`${name} failed to load from all candidates.`);
}

async function boot() {
  try {
    // Candidate lists (multiple CDNs)
    const jqueryCandidates = [
      'https://code.jquery.com/jquery-3.6.0.min.js',
      'https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js'
    ];
    const chessJsCandidates = [
      'https://unpkg.com/chess.js@1.0.0/chess.min.js',
      'https://cdn.jsdelivr.net/npm/chess.js@1.0.0/chess.min.js',
      'https://cdn.jsdelivr.net/npm/chess.js@0.13.4/chess.min.js'
    ];
    const chessboardCandidates = [
      'https://unpkg.com/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js',
      'https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js',
      'https://cdn.jsdelivr.net/gh/oakmac/chessboardjs@master/dist/chessboard-1.0.0.min.js'
    ];

    // Load jQuery first
    await tryCandidates('jQuery', jqueryCandidates);

    // Load chess.js
    await tryCandidates('chess.js', chessJsCandidates);

    // Load chessboard.js
    await tryCandidates('chessboardjs', chessboardCandidates);

    // Small delay to allow bindings
    await new Promise(r=>setTimeout(r,200));

    // Verify loaded objects
    if (typeof window.Chess !== 'function' && typeof window.Chess !== 'object') {
      throw new Error('chess.js did not expose Chess constructor.');
    }
    if (typeof window.Chessboard === 'undefined') {
      throw new Error('chessboardjs did not expose Chessboard.');
    }

    logLine('All libraries loaded — initializing board...', 'ok');

    // Initialize chessboardjs
    const game = new Chess();
    const cb = Chessboard('board', {
      draggable: true,
      position: 'start',
      pieceTheme: 'https://unpkg.com/chessboardjs@1.0.0/dist/img/chesspieces/wikipedia/{piece}.png',
      onDrop: function (source, target) {
        const m = game.move({ from: source, to: target, promotion: 'q' });
        if (m === null) return 'snapback';
        logLine('Move: ' + m.san, 'ok');
      }
    });

    logLine('Board initialized successfully. If you do not see the board, refresh the page.', 'ok');

  } catch (err) {
    logLine('BOOT ERROR: ' + (err && err.message ? err.message : String(err)), 'err');
    logLine('If a candidate failed to load, try opening that URL directly in your phone browser to see error text/404.', 'err');
  }
}

/* Start boot */
boot();
</script>
</body>
  </html>
